<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tablero de control del propietario</title>
    <link rel="stylesheet" href="../globals.css" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
  <body class="bg-[var(--background)] text-[var(--foreground)] p-8">
    <div class="max-w-7xl mx-auto">
      <!-- Header -->
      <div class="bg-[var(--card)] border border-[var(--border)] mb-6">
        <div class="bg-[var(--primary)] text-[var(--primary-foreground)] p-4 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-[var(--chart-3)] border border-[var(--primary-foreground)]"></div>
            <h1 class="text-xl font-bold">Tablero de control del propietario</h1>
          </div>
          <a href="#" id="btnSalir" class="text-[var(--primary-foreground)] hover:opacity-80 underline">Salir</a>
        </div>
      </div>

      <!-- Resumen del propietario -->
      <div class="bg-[var(--card)] border border-[var(--border)] mb-6">
        <div class="p-6">
          <h2 class="text-lg font-bold text-[var(--foreground)] mb-4">Resumen del propietario</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-[var(--background)] border-l-4 border-l-[var(--primary)] border border-[var(--border)] p-4">
              <p class="text-xs text-[var(--muted-foreground)] mb-2 uppercase tracking-wider">Nombre completo</p>
              <p class="text-base font-semibold text-[var(--foreground)]">Juan Pérez</p>
            </div>
            <div class="bg-[var(--background)] border-l-4 border-l-[var(--chart-2)] border border-[var(--border)] p-4">
              <p class="text-xs text-[var(--muted-foreground)] mb-2 uppercase tracking-wider">Estado</p>
              <p class="text-base font-semibold text-[var(--foreground)]">Activo</p>
            </div>
            <div class="bg-[var(--background)] border-l-4 border-l-[var(--chart-3)] border border-[var(--border)] p-4">
              <p class="text-xs text-[var(--muted-foreground)] mb-2 uppercase tracking-wider">Saldo actual</p>
              <p class="text-base font-semibold text-[var(--foreground)]">$ 2.540,00</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Bonificaciones y Vehículos -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- Bonificaciones asignadas -->
        <div class="bg-[var(--card)] border border-[var(--border)]">
          <div class="p-6">
            <h2 class="text-lg font-bold text-[var(--foreground)] mb-4">Bonificaciones asignadas</h2>
            <div class="overflow-x-auto">
              <table class="w-full border border-[var(--border)]">
                <thead class="bg-[var(--muted)]">
                  <tr>
                    <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Bonificación</th>
                    <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Puesto</th>
                    <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Fecha asignada</th>
                  </tr>
                </thead>
                <tbody class="bg-[var(--background)]">
                  <tr>
                    <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">Frecuente</td>
                    <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">Peaje Norte</td>
                    <td class="py-3 px-4 text-sm text-[var(--muted-foreground)] border-b border-[var(--border)]">2025-01-10</td>
                  </tr>
                  <tr>
                    <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">Trabajador</td>
                    <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">Peaje Centro</td>
                    <td class="py-3 px-4 text-sm text-[var(--muted-foreground)] border-b border-[var(--border)]">2025-03-02</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Vehículos registrados -->
        <div class="bg-[var(--card)] border border-[var(--border)]">
          <div class="p-6">
            <h2 class="text-lg font-bold text-[var(--foreground)] mb-4">Vehículos registrados</h2>
            <div class="overflow-x-auto">
              <table class="w-full border border-[var(--border)]">
                <thead class="bg-[var(--muted)]">
                  <tr>
                    <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Matrícula</th>
                    <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Modelo</th>
                    <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Color</th>
                    <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Tránsitos</th>
                    <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Monto total</th>
                  </tr>
                </thead>
                <tbody class="bg-[var(--background)]">
                  <tr>
                    <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">SAB1234</td>
                    <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">Sedán</td>
                    <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">Azul</td>
                    <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">12</td>
                    <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">$ 1.240,00</td>
                  </tr>
                  <tr>
                    <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">SCD5678</td>
                    <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">SUV</td>
                    <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">Gris</td>
                    <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">8</td>
                    <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">$ 980,00</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Tránsitos realizados -->
      <div class="bg-[var(--card)] border border-[var(--border)] mb-6">
        <div class="p-6">
          <h2 class="text-lg font-bold text-[var(--foreground)] mb-4">Tránsitos realizados</h2>
          <div class="overflow-x-auto">
            <table class="w-full border border-[var(--border)]">
              <thead class="bg-[var(--muted)]">
                <tr>
                  <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Puesto</th>
                  <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Matrícula</th>
                  <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Categoría</th>
                  <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Monto tarifa</th>
                  <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Bonificación</th>
                  <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Monto bonificación</th>
                  <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Monto pagado</th>
                  <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Fecha</th>
                  <th class="text-left py-3 px-4 text-sm font-semibold text-[var(--foreground)] border-b border-[var(--border)]">Hora</th>
                </tr>
              </thead>
              <tbody class="bg-[var(--background)]">
                <tr>
                  <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">Peaje Sur</td>
                  <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">SAB1234</td>
                  <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">Motocicleta</td>
                  <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">$ 120,00</td>
                  <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">Frecuente</td>
                  <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">-$ 24,00</td>
                  <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">$ 96,00</td>
                  <td class="py-3 px-4 text-sm text-[var(--muted-foreground)] border-b border-[var(--border)]">2025-09-19</td>
                  <td class="py-3 px-4 text-sm text-[var(--muted-foreground)] border-b border-[var(--border)]">18:45</td>
                </tr>
                <tr>
                  <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">Peaje Norte</td>
                  <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">SCD5678</td>
                  <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">Camión</td>
                  <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">$ 180,00</td>
                  <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">Trabajador</td>
                  <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">-$ 36,00</td>
                  <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">$ 144,00</td>
                  <td class="py-3 px-4 text-sm text-[var(--muted-foreground)] border-b border-[var(--border)]">2025-09-18</td>
                  <td class="py-3 px-4 text-sm text-[var(--muted-foreground)] border-b border-[var(--border)]">08:22</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Notificaciones del sistema -->
      <div class="bg-[var(--card)] border border-[var(--border)] mb-6">
        <div class="p-6">
          <div class="flex justify-between items-center mb-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-[var(--primary)] border border-[var(--primary)] flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[var(--primary-foreground)]" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z" />
                </svg>
              </div>
              <h2 class="text-lg font-bold text-[var(--foreground)]">Notificaciones del sistema</h2>
            </div>
            <button
              id="btnBorrarNotificaciones"
              class="bg-[var(--destructive)] hover:opacity-90 text-white font-semibold px-4 py-2 border border-[var(--destructive)] transition-opacity"
            >
              Borrar notificaciones
            </button>
          </div>
          <div class="space-y-3">
            <div class="bg-[var(--background)] border border-[var(--border)] p-4 flex gap-4">
              <div class="flex-shrink-0">
                <div class="w-8 h-8 bg-[var(--primary)] border border-[var(--primary)] flex items-center justify-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-[var(--primary-foreground)]" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
                  </svg>
                </div>
              </div>
              <div class="flex-1">
                <p class="text-sm text-[var(--foreground)]">
                  Tránsito realizado en Peaje Sur con vehículo SAB1234. Monto pagado: $ 96,00
                </p>
                <p class="text-xs text-[var(--muted-foreground)] mt-2">2025-09-19 18:45</p>
              </div>
            </div>
            <div class="bg-[var(--background)] border border-[var(--border)] p-4 flex gap-4">
              <div class="flex-shrink-0">
                <div class="w-8 h-8 bg-[var(--destructive)] border border-[var(--destructive)] flex items-center justify-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                  </svg>
                </div>
              </div>
              <div class="flex-1">
                <p class="text-sm text-[var(--foreground)]">
                  Su saldo es bajo. Saldo actual: $ 2.540,00. Por favor recargue para continuar usando el sistema.
                </p>
                <p class="text-xs text-[var(--muted-foreground)] mt-2">2025-09-18 08:22</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="../vistaWeb.js"></script>
    <script>
      // Configuración para vistaWeb.js
      urlIniciarVista = "/propietario/vistaConectada";
      urlCierreVista = "/propietario/vistaCerrada";

      // Event listeners
      document
        .getElementById("btnBorrarNotificaciones")
        .addEventListener("click", borrarNotificaciones);
      document.getElementById("btnSalir").addEventListener("click", salir);

      async function borrarNotificaciones() {
        // TODO: Implement delete notifications
        console.log("Borrar notificaciones");
      }

      function salir() {
        submit("/login/logoutPropietario", "", "POST");
      }

      // Handlers para vistaWeb.js
      window["mostrar_nombrePropietario"] = function(parametro) {
        console.log("Propietario conectado:", parametro);
      };

      window["mostrar_datosPropietario"] = function(parametro) {
        console.log("Datos del propietario:", parametro);
        renderizarDatosPropietario(parametro);
      };

      window["mostrar_paginaLogin"] = function(parametro) {
        window.location.href = parametro || "/login.html";
      };

      function renderizarDatosPropietario(propietario) {
        // Actualizar resumen
        const resumenContainer = document.querySelector('.grid.grid-cols-1.md\\:grid-cols-3');
        
        const estadoColor = obtenerColorEstado(propietario.estado.nombre);
        const mensajeRestriccion = propietario.estado.nombre !== "Habilitado" 
          ? `<p class="text-xs text-[var(--destructive)] mt-2">⚠️ ${obtenerMensajeEstado(propietario)}</p>` 
          : '';
        
        resumenContainer.innerHTML = `
          <div class="bg-[var(--background)] border-l-4 border-l-[var(--primary)] border border-[var(--border)] p-4">
            <p class="text-xs text-[var(--muted-foreground)] mb-2 uppercase tracking-wider">Nombre completo</p>
            <p class="text-base font-semibold text-[var(--foreground)]">${propietario.nombre || 'N/A'}</p>
            <p class="text-xs text-[var(--muted-foreground)] mt-1">CI: ${propietario.ci || 'N/A'}</p>
          </div>
          <div class="bg-[var(--background)] border-l-4 ${estadoColor} border border-[var(--border)] p-4">
            <p class="text-xs text-[var(--muted-foreground)] mb-2 uppercase tracking-wider">Estado</p>
            <p class="text-base font-semibold text-[var(--foreground)]">${propietario.estado.nombre}</p>
            ${mensajeRestriccion}
          </div>
          <div class="bg-[var(--background)] border-l-4 border-l-[var(--chart-3)] border border-[var(--border)] p-4">
            <p class="text-xs text-[var(--muted-foreground)] mb-2 uppercase tracking-wider">Saldo actual</p>
            <p class="text-base font-semibold text-[var(--foreground)]">$ ${propietario.saldo.toFixed(2)}</p>
            <p class="text-xs text-[var(--muted-foreground)] mt-1">Alerta: $ ${propietario.saldoMinAlerta.toFixed(2)}</p>
          </div>
        `;

        // Renderizar vehículos
        renderizarVehiculos(propietario.vehiculo || []);
        
        // Renderizar bonificaciones
        renderizarBonificaciones(propietario.asignaciones || []);
      }

      function obtenerColorEstado(estado) {
        switch(estado) {
          case "Habilitado": return "border-l-[var(--chart-2)]";
          case "Deshabilitado": return "border-l-[var(--destructive)]";
          case "Suspendido": return "border-l-[var(--chart-4)]";
          case "Penalizado": return "border-l-[var(--chart-5)]";
          default: return "border-l-[var(--muted)]";
        }
      }

      function obtenerMensajeEstado(propietario) {
        const estado = propietario.estado.nombre;
        switch(estado) {
          case "Deshabilitado":
            return "No puede realizar ninguna operación en el sistema";
          case "Suspendido":
            return "No puede realizar tránsitos";
          case "Penalizado":
            return "Las bonificaciones no aplican en tránsitos. No recibe notificaciones";
          default:
            return "";
        }
      }

      function renderizarVehiculos(vehiculos) {
        const tbody = document.querySelector('.bg-[var\\(--card\\)].border:has(h2:contains("Vehículos")) tbody');
        if (!tbody) return;

        if (vehiculos.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="5" class="py-4 px-4 text-sm text-[var(--muted-foreground)] text-center">
                No hay vehículos registrados
              </td>
            </tr>
          `;
          return;
        }

        tbody.innerHTML = vehiculos.map(v => `
          <tr>
            <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">${v.matricula}</td>
            <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">${v.modelo || 'N/A'}</td>
            <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">${v.color || 'N/A'}</td>
            <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">0</td>
            <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">$ 0.00</td>
          </tr>
        `).join('');
      }

      function renderizarBonificaciones(asignaciones) {
        const tbody = document.querySelector('.bg-[var\\(--card\\)].border:has(h2:contains("Bonificaciones")) tbody');
        if (!tbody) return;

        if (asignaciones.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="3" class="py-4 px-4 text-sm text-[var(--muted-foreground)] text-center">
                No hay bonificaciones asignadas
              </td>
            </tr>
          `;
          return;
        }

        tbody.innerHTML = asignaciones.map(a => `
          <tr>
            <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">${a.bonificacion.nombre}</td>
            <td class="py-3 px-4 text-sm text-[var(--foreground)] border-b border-[var(--border)]">${a.puesto.nombre}</td>
            <td class="py-3 px-4 text-sm text-[var(--muted-foreground)] border-b border-[var(--border)]">-</td>
          </tr>
        `).join('');
      }
    </script>
  </body>
</html>
